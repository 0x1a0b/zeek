#!/usr/bin/env python
import argparse

from broutil.BroLogManager import *
from broutil.BroLogOptions import *

def parse_args():
    parser = argparse.ArgumentParser(description='General-purpose tool for manipulating bro log files')
    parser.add_argument('-v', default=False, action='store_true', dest='verbose', help='Explain what the script is doing')
    parser.add_argument('logfiles', metavar='LOGFILE', nargs='+', help='Bro logfiles to load')
    return parser.parse_args()

if __name__ == '__main__':
    args = parse_args()
    BroLogOptions.verbose = args.verbose
    manager = BroLogManager(sampling='0.1')
    manager.load(args.logfiles)
    connections = manager["conn"]  # or '.get("conn")
    print 'orig_bytes: ' + str(connections.get_stats('orig_bytes'))
    print 'resp_bytes: ' + str(connections.get_stats('resp_bytes'))
    print 'Top 5 id.orig_p entries:' 
    for x in xrange(5):
        print str(connections.get_stats('id.orig_p').get_index(x)), 
    print ''
    print 'Top 5 id.resp_p entries:'
    for x in xrange(5):
        print str(connections.get_stats('id.resp_p').get_index(x)),
    print ''

    #for e in manager["conn"].entries():
    #    print e['id.resp_p']
